# OC22 VASP 复现设置（本仓库记录）

目的：记录“为什么这样设”和“哪些地方最容易踩坑”，而不是给出一份自称“官方一致”的 INCAR。

关键结论先写在最前面：
- **对比 OC22 原始标签时，必须做单点（single-point），不能做结构优化。**
- **LDAU / MAGMOM / KPOINTS 都是“结构相关”的，必须按每个样本单独展开。**
- OC22 的完整官方 VASP 设置（尤其 POTCAR 细节）并未公开到“可逐字节复现”的程度，因此这里只能做“尽量一致的近似复现”。

---

## 1) 当前目录与语义（请不要污染数据）

本仓库目前使用两套样本目录：

1) 基线单点（不显式给 MAGMOM）
- 路径：`Data/oc22_data/oc22_data/temp/sample_0000..0009`
- 特征：
  - 已切换为单点：`IBRION=-1, NSW=0, ISIF=0`
  - LDAU 使用 VASP 认可的“数组格式”（按物种顺序展开）
  - `POTCAR.symbols` 作为“物种顺序的唯一来源”

2) 磁性对比（仅改变 MAGMOM）
- 路径：`Data/oc22_data/oc22_data/temp2/sample_0000..0009`
- 特征：
  - 与 `temp` 完全相同，仅新增 `MAGMOM = ...`
  - 目的：评估“初始磁矩是否导致能量/力偏移”

强约束（避免再次踩坑）：
- `temp/` 视为“对照组数据集”，不要在里面继续实验性改动。
- 新的试验（例如改磁性、改 KPOINTS 规则）请开新目录（如 `temp2/` / `temp3/`）。

---

## 2) 我们为什么这样设（决策依据，而不是官方真相）

### 2.1 单点而非结构优化

OC22/S2EF 的目标是对“给定结构”预测能量与力。

因此当我们要拿 VASP 回算去对比 OC22 标签时：
- 应该固定结构（单点），而不是把结构继续弛豫到另一个极小值；
- 否则你对比的就不再是“同一个构型”的标签，误差会被结构漂移主导。

这也是之前出现大偏差的根因之一（结构优化任务与对标 OC22 的目标不一致）。

### 2.2 MP 口径作为“最稳妥默认值”

OC22 的 bulk oxides 来自 Materials Project（MP）。

在缺少 OC22 完整公开 INCAR/POTCAR 细节时，采用 MP 口径（PBE + ISPIN=2 + MP 的 U 表）是最合理的“默认近似”。

这不是“官方等价”，而是“有来源的默认值”。

---

## 3) 当前模板的结构（哪些是固定的，哪些必须逐样本展开）

### 3.1 固定项（跨样本不变）

固定项的目标是“稳”和“可比”：
- 泛函：`GGA = PE`
- 自旋：`ISPIN = 2`
- 截断能：`ENCUT = 500`
- 展宽：`ISMEAR = 0`, `SIGMA = 0.05`
- 对称性：`ISYM = 0`
- 偶极修正：`LDIPOL = .TRUE.`, `IDIPOL = 3`
- 单点：`IBRION = -1`, `NSW = 0`, `ISIF = 0`

这些并不保证“完全等同 OC22”，但能保证“单点对比的语义正确”。

### 3.2 结构相关项（必须逐样本展开）

下面这些不能写死为“一份模板”：

1) `KPOINTS`
- 目前使用 slab 保守规则：
  - `kx = ceil(30 / |a|)`
  - `ky = ceil(30 / |b|)`
  - `kz = 1`
- 这是“工程默认值”，不是 OC22 官方设置。

2) `LDAU` 三行数组（最容易出错）
- VASP 要求每个物种一个值，且顺序必须与 `POTCAR.symbols` 一致：
  - `LDAUL = ...`
  - `LDAUU = ...`
  - `LDAUJ = ...`
- 任何“字典格式”“逗号分隔”“长度不匹配”都会直接失败或产生不可控偏差。

3) `MAGMOM`（若启用）
- 同样必须按物种顺序展开。
- `temp2/` 的 `MAGMOM` 只是“对比用的简化初值”，不是物理上最优的磁矩设置。

---

## 4) 目前能解释的大偏差来源（优先级排序）

当 VASP 与 OC22 标签存在明显偏差时，优先排查顺序建议如下：

1) 任务类型错了（最致命）
- 是否误做了结构优化而不是单点？

2) LDAU / MAGMOM 展开错位
- 数组长度是否等于物种数？
- 顺序是否严格等于 `POTCAR.symbols`？

3) POTCAR 不一致（即使名义上是 v54）
- 即便同为 `potpaw_PBE.54`，不同来源/不同符号变体也会导致可观偏移；
- OC22/MP 的 POTCAR 细节没有公开到“可逐字节复现”的程度。

4) KPOINTS 规则不同
- k 点密度对能量基线与力都有影响，尤其对 slab / 金属体系更敏感。

---

## 5) 最小自检清单（提交任务前请逐条过一遍）

对每个 `sample_XXXX/`：

1) 单点语义
- `IBRION = -1`
- `NSW = 0`
- `ISIF = 0`

2) 物种顺序一致性
- `POTCAR.symbols` 是物种顺序的唯一真相来源
- `LDAUL/LDAUU/LDAUJ/MAGMOM` 都必须与其一一对应

3) 语法层面
- `DIPOL` 用空格分隔，不能带逗号
- 不要使用字典或 JSON 风格的 LDAU 写法

---

## 6) 这份文档的定位（避免误解）

这不是“OC22 官方设置”，而是：
- 一套语义正确（单点对比）
- 有来源依据（MP 口径）
- 且明确标注了不确定性的工程复现基线。

如果后续拿到 OC22 更权威的计算细节（尤其 POTCAR / KPOINTS / 磁矩策略），应当在此文档更新“为什么变更”，而不是只改参数。
